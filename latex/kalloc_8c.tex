\hypertarget{kalloc_8c}{}\section{kalloc.\+c File Reference}
\label{kalloc_8c}\index{kalloc.\+c@{kalloc.\+c}}
{\ttfamily \#include \char`\"{}types.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}defs.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}param.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}memlayout.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mmu.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}kalloc.\+h\char`\"{}}\\*
Include dependency graph for kalloc.\+c\+:
% FIG 0
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{kalloc_8c_adeb1e621acdd949dffd5a054a43d1d89}{freerange} (void $\ast$vstart, void $\ast$vend)
\item 
int \hyperlink{kalloc_8c_a6bf5aaf3c1623fbc75279a59e7bcadda}{kdecref} (char $\ast$va)
\begin{DoxyCompactList}\small\item\em Decrements the \hyperlink{structpage__info_aa5d70e774275d72f2ecb55bb78ae6a9e}{page\+\_\+info.\+refcount} field for corresponding phy page. Frees if refcount reaches 0. \end{DoxyCompactList}\item 
int \hyperlink{kalloc_8c_a654f70eb00920123570701eb561a2dc3}{kinsert} (\hyperlink{custom__types_8h_ac131849542282b2c95dfeaf1f26dc010}{pde\+\_\+t} $\ast$pgdir, struct \hyperlink{structpage__info}{page\+\_\+info} $\ast$pp, char $\ast$va, int perm)
\begin{DoxyCompactList}\small\item\em Maps the physical page associated with pp at virtual address va Removes previous mapping, if any. Allocates a page table if needed and inserts it into pgdir. \end{DoxyCompactList}\item 
void \hyperlink{kalloc_8c_a9ba746e6dc1f08b3cf2825c278d09a41}{kremove} (\hyperlink{custom__types_8h_ac131849542282b2c95dfeaf1f26dc010}{pde\+\_\+t} $\ast$pgdir, void $\ast$va)
\begin{DoxyCompactList}\small\item\em Unmaps the physical page at virtual address va. If no page at va, does nothing. \end{DoxyCompactList}\item 
struct \hyperlink{structpage__info}{page\+\_\+info} $\ast$ \hyperlink{kalloc_8c_a9541ef47936123e59217b7379357e8dd}{klookup} (\hyperlink{custom__types_8h_ac131849542282b2c95dfeaf1f26dc010}{pde\+\_\+t} $\ast$pgdir, void $\ast$va, \hyperlink{custom__types_8h_ab23e75f764f8314a83eaff23508c2ae5}{pte\+\_\+t} $\ast$$\ast$pte\+\_\+store)
\begin{DoxyCompactList}\small\item\em Finds and returns (a pointer to the \hyperlink{structpage__info}{page\+\_\+info} of) the physical page mapped at virtual address va. If pte\+\_\+store is non-\/null, sets it to save the virtual address of the pte for the physical page. \end{DoxyCompactList}\item 
void \hyperlink{kalloc_8c_a596c07f040e83fd8ea1857f36ffab4fb}{kinit1} (void $\ast$vstart, void $\ast$vend)
\item 
void \hyperlink{kalloc_8c_a8efe9094969255a41fbdaaee820bd478}{kinit2} (void $\ast$vstart, void $\ast$vend)
\item 
void \hyperlink{kalloc_8c_a8d991b34ccd50196cc19720cd4495e2c}{kmarkused} (void $\ast$vstart, void $\ast$vend)
\begin{DoxyCompactList}\small\item\em Marks pages in range (vstart, vend) as used. \end{DoxyCompactList}\item 
void \hyperlink{kalloc_8c_aced59ecf8411235f6dffc065236711a5}{kfree} (char $\ast$v)
\item 
char $\ast$ \hyperlink{kalloc_8c_a3af104ba40b66dcec8363ac5a70907ed}{kalloc} (void)
\item 
void \hyperlink{kalloc_8c_a2dbc043f63eeea52478aae2bb0907a4b}{increfcount} (char $\ast$va)
\begin{DoxyCompactList}\small\item\em finds \hyperlink{structpage__info}{page\+\_\+info} from va and increments its refcount \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
char \hyperlink{kalloc_8c_af4f810c521bcfd87215d3007005a8325}{end} \mbox{[}$\,$\mbox{]}
\item 
struct \hyperlink{structkmem}{kmem} \hyperlink{kalloc_8c_a2307515f26ea582519bfdd4f29ea9489}{kmem}
\item 
struct \hyperlink{structpage__info}{page\+\_\+info} \hyperlink{kalloc_8c_a02cbbb1e2d616dcbd0c0daa554fb34d0}{ppages\+\_\+info} \mbox{[}0x\+E000\mbox{]} = \{0\}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\index{kalloc.\+c@{kalloc.\+c}!freerange@{freerange}}
\index{freerange@{freerange}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{freerange(void $\ast$vstart, void $\ast$vend)}{freerange(void *vstart, void *vend)}}]{\setlength{\rightskip}{0pt plus 5cm}void freerange (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{vstart, }
\item[{void $\ast$}]{vend}
\end{DoxyParamCaption}
)}\hypertarget{kalloc_8c_adeb1e621acdd949dffd5a054a43d1d89}{}\label{kalloc_8c_adeb1e621acdd949dffd5a054a43d1d89}
\index{kalloc.\+c@{kalloc.\+c}!increfcount@{increfcount}}
\index{increfcount@{increfcount}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{increfcount(char $\ast$va)}{increfcount(char *va)}}]{\setlength{\rightskip}{0pt plus 5cm}void increfcount (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{va}
\end{DoxyParamCaption}
)}\hypertarget{kalloc_8c_a2dbc043f63eeea52478aae2bb0907a4b}{}\label{kalloc_8c_a2dbc043f63eeea52478aae2bb0907a4b}


finds \hyperlink{structpage__info}{page\+\_\+info} from va and increments its refcount 


\begin{DoxyParams}{Parameters}
{\em va} & (kernel) virtual address of the page, must be page alined \\
\hline
\end{DoxyParams}
\index{kalloc.\+c@{kalloc.\+c}!kalloc@{kalloc}}
\index{kalloc@{kalloc}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{kalloc(void)}{kalloc(void)}}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ kalloc (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\hypertarget{kalloc_8c_a3af104ba40b66dcec8363ac5a70907ed}{}\label{kalloc_8c_a3af104ba40b66dcec8363ac5a70907ed}
\index{kalloc.\+c@{kalloc.\+c}!kdecref@{kdecref}}
\index{kdecref@{kdecref}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{kdecref(char $\ast$va)}{kdecref(char *va)}}]{\setlength{\rightskip}{0pt plus 5cm}int kdecref (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{va}
\end{DoxyParamCaption}
)}\hypertarget{kalloc_8c_a6bf5aaf3c1623fbc75279a59e7bcadda}{}\label{kalloc_8c_a6bf5aaf3c1623fbc75279a59e7bcadda}


Decrements the \hyperlink{structpage__info_aa5d70e774275d72f2ecb55bb78ae6a9e}{page\+\_\+info.\+refcount} field for corresponding phy page. Frees if refcount reaches 0. 


\begin{DoxyParams}{Parameters}
{\em va} & (kernel) virtual address of the page, must be page allined \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 if page was freed, 0 otherwise 
\end{DoxyReturn}
\index{kalloc.\+c@{kalloc.\+c}!kfree@{kfree}}
\index{kfree@{kfree}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{kfree(char $\ast$v)}{kfree(char *v)}}]{\setlength{\rightskip}{0pt plus 5cm}void kfree (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{v}
\end{DoxyParamCaption}
)}\hypertarget{kalloc_8c_aced59ecf8411235f6dffc065236711a5}{}\label{kalloc_8c_aced59ecf8411235f6dffc065236711a5}
\index{kalloc.\+c@{kalloc.\+c}!kinit1@{kinit1}}
\index{kinit1@{kinit1}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{kinit1(void $\ast$vstart, void $\ast$vend)}{kinit1(void *vstart, void *vend)}}]{\setlength{\rightskip}{0pt plus 5cm}void kinit1 (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{vstart, }
\item[{void $\ast$}]{vend}
\end{DoxyParamCaption}
)}\hypertarget{kalloc_8c_a596c07f040e83fd8ea1857f36ffab4fb}{}\label{kalloc_8c_a596c07f040e83fd8ea1857f36ffab4fb}
\index{kalloc.\+c@{kalloc.\+c}!kinit2@{kinit2}}
\index{kinit2@{kinit2}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{kinit2(void $\ast$vstart, void $\ast$vend)}{kinit2(void *vstart, void *vend)}}]{\setlength{\rightskip}{0pt plus 5cm}void kinit2 (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{vstart, }
\item[{void $\ast$}]{vend}
\end{DoxyParamCaption}
)}\hypertarget{kalloc_8c_a8efe9094969255a41fbdaaee820bd478}{}\label{kalloc_8c_a8efe9094969255a41fbdaaee820bd478}
\index{kalloc.\+c@{kalloc.\+c}!kinsert@{kinsert}}
\index{kinsert@{kinsert}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{kinsert(pde\+\_\+t $\ast$pgdir, struct page\+\_\+info $\ast$pp, char $\ast$va, int perm)}{kinsert(pde_t *pgdir, struct page_info *pp, char *va, int perm)}}]{\setlength{\rightskip}{0pt plus 5cm}int kinsert (
\begin{DoxyParamCaption}
\item[{{\bf pde\+\_\+t} $\ast$}]{pgdir, }
\item[{struct {\bf page\+\_\+info} $\ast$}]{pp, }
\item[{char $\ast$}]{va, }
\item[{int}]{perm}
\end{DoxyParamCaption}
)}\hypertarget{kalloc_8c_a654f70eb00920123570701eb561a2dc3}{}\label{kalloc_8c_a654f70eb00920123570701eb561a2dc3}


Maps the physical page associated with pp at virtual address va Removes previous mapping, if any. Allocates a page table if needed and inserts it into pgdir. 


\begin{DoxyParams}{Parameters}
{\em pgdir} & (pointer to) the page directory \\
\hline
{\em pp} & (pointer to) the \hyperlink{structpage__info}{page\+\_\+info} of the physical page to map \\
\hline
{\em va} & virtual address where to map the page \\
\hline
{\em perm} & permission bits \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/1 if page table could not be allocated, 0 otherwise 
\end{DoxyReturn}
\index{kalloc.\+c@{kalloc.\+c}!klookup@{klookup}}
\index{klookup@{klookup}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{klookup(pde\+\_\+t $\ast$pgdir, void $\ast$va, pte\+\_\+t $\ast$$\ast$pte\+\_\+store)}{klookup(pde_t *pgdir, void *va, pte_t **pte_store)}}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf page\+\_\+info}$\ast$ klookup (
\begin{DoxyParamCaption}
\item[{{\bf pde\+\_\+t} $\ast$}]{pgdir, }
\item[{void $\ast$}]{va, }
\item[{{\bf pte\+\_\+t} $\ast$$\ast$}]{pte\+\_\+store}
\end{DoxyParamCaption}
)}\hypertarget{kalloc_8c_a9541ef47936123e59217b7379357e8dd}{}\label{kalloc_8c_a9541ef47936123e59217b7379357e8dd}


Finds and returns (a pointer to the \hyperlink{structpage__info}{page\+\_\+info} of) the physical page mapped at virtual address va. If pte\+\_\+store is non-\/null, sets it to save the virtual address of the pte for the physical page. 


\begin{DoxyParams}{Parameters}
{\em pgdir} & (pointer to) the page directory \\
\hline
{\em va} & virtual address \\
\hline
{\em pte\+\_\+store} & (pointer to) a pte entry address \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
(a pointer to) the \hyperlink{structpage__info}{page\+\_\+info} of the mapped physical page (if any), N\+U\+LL otherwise 
\end{DoxyReturn}
\index{kalloc.\+c@{kalloc.\+c}!kmarkused@{kmarkused}}
\index{kmarkused@{kmarkused}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{kmarkused(void $\ast$vstart, void $\ast$vend)}{kmarkused(void *vstart, void *vend)}}]{\setlength{\rightskip}{0pt plus 5cm}void kmarkused (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{vstart, }
\item[{void $\ast$}]{vend}
\end{DoxyParamCaption}
)}\hypertarget{kalloc_8c_a8d991b34ccd50196cc19720cd4495e2c}{}\label{kalloc_8c_a8d991b34ccd50196cc19720cd4495e2c}


Marks pages in range (vstart, vend) as used. 


\begin{DoxyParams}{Parameters}
{\em vstart} & virtual address (low), not necessarily page aligned \\
\hline
{\em vend} & virtual address (high), not necessarily page aligned \\
\hline
\end{DoxyParams}
\index{kalloc.\+c@{kalloc.\+c}!kremove@{kremove}}
\index{kremove@{kremove}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{kremove(pde\+\_\+t $\ast$pgdir, void $\ast$va)}{kremove(pde_t *pgdir, void *va)}}]{\setlength{\rightskip}{0pt plus 5cm}void kremove (
\begin{DoxyParamCaption}
\item[{{\bf pde\+\_\+t} $\ast$}]{pgdir, }
\item[{void $\ast$}]{va}
\end{DoxyParamCaption}
)}\hypertarget{kalloc_8c_a9ba746e6dc1f08b3cf2825c278d09a41}{}\label{kalloc_8c_a9ba746e6dc1f08b3cf2825c278d09a41}


Unmaps the physical page at virtual address va. If no page at va, does nothing. 


\begin{DoxyParams}{Parameters}
{\em pgdir} & (pointer to) the page directory \\
\hline
{\em va} & virtual address \\
\hline
\end{DoxyParams}


\subsection{Variable Documentation}
\index{kalloc.\+c@{kalloc.\+c}!end@{end}}
\index{end@{end}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{end}{end}}]{\setlength{\rightskip}{0pt plus 5cm}char end\mbox{[}$\,$\mbox{]}}\hypertarget{kalloc_8c_af4f810c521bcfd87215d3007005a8325}{}\label{kalloc_8c_af4f810c521bcfd87215d3007005a8325}
\index{kalloc.\+c@{kalloc.\+c}!kmem@{kmem}}
\index{kmem@{kmem}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{kmem}{kmem}}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf kmem} {\bf kmem}}\hypertarget{kalloc_8c_a2307515f26ea582519bfdd4f29ea9489}{}\label{kalloc_8c_a2307515f26ea582519bfdd4f29ea9489}
\index{kalloc.\+c@{kalloc.\+c}!ppages\+\_\+info@{ppages\+\_\+info}}
\index{ppages\+\_\+info@{ppages\+\_\+info}!kalloc.\+c@{kalloc.\+c}}
\subsubsection[{\texorpdfstring{ppages\+\_\+info}{ppages_info}}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf page\+\_\+info} ppages\+\_\+info\mbox{[}0x\+E000\mbox{]} = \{0\}}\hypertarget{kalloc_8c_a02cbbb1e2d616dcbd0c0daa554fb34d0}{}\label{kalloc_8c_a02cbbb1e2d616dcbd0c0daa554fb34d0}
